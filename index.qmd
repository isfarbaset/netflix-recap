---
title: ""
format:
  html:
    toc: false
execute:
  echo: false
jupyter: python3
---

```{python}
#| include: false
import json
import re
from pathlib import Path
from IPython.display import display, HTML

# Load stats
stats_file = Path("data/wrapped_stats.json")
if stats_file.exists():
    with open(stats_file) as f:
        stats = json.load(f)
else:
    # Sample data for preview - 2025
    stats = {
        "year": 2025,
        "total_titles_watched": 923,
        "unique_shows": 168,
        "estimated_hours": 692,
        "estimated_days": 28.8,
        "number_one_show": "Wednesday",
        "number_one_count": 58,
        "peak_month": "November",
        "peak_month_count": 118,
        "favorite_day": "Saturday",
        "favorite_day_count": 198,
        "longest_streak": 27,
        "binge_sessions": 42,
        "biggest_binge": 14,
        "biggest_binge_show": "Squid Game",
        "active_days": 312,
        "peak_time": "Evening (6pm-10pm)",
        "personality": {
            "type": "The Binge Master",
            "description": "One more episode? Make that ten. Sleep is optional when the plot thickens."
        },
        "top_shows": [
            {"title": "Wednesday", "count": 58},
            {"title": "Stranger Things", "count": 52},
            {"title": "The Crown", "count": 45},
            {"title": "Squid Game", "count": 41},
            {"title": "Money Heist", "count": 36}
        ],
        "monthly_breakdown": {
            "January": 72, "February": 65, "March": 78, "April": 71,
            "May": 58, "June": 64, "July": 82, "August": 89,
            "September": 96, "October": 108, "November": 118, "December": 22
        },
        "day_of_week": {
            "Monday": 98, "Tuesday": 105, "Wednesday": 112, "Thursday": 118,
            "Friday": 145, "Saturday": 198, "Sunday": 163
        },
        "time_categories": {
            "Morning (6am-12pm)": 85,
            "Afternoon (12pm-6pm)": 198,
            "Evening (6pm-10pm)": 456,
            "Night Owl (10pm-6am)": 184
        },
        "fun_facts": [
            "You could have flown to Tokyo 49.4 times with your watch time.",
            "In this time, you could have read approximately 115 books. But who is counting?",
            "Your 27-day streak shows true dedication. Netflix should send you a trophy.",
            "With 42 binge sessions, you have mastered the art of just one more episode."
        ]
    }

def highlight_numbers(text):
    """Highlight numbers in text with span tags."""
    return re.sub(r'(\d+\.?\d*)', r'<span class="highlight">\1</span>', text)

year = stats.get("year", 2025)
hours = stats.get("estimated_hours", 0)
days = stats.get("estimated_days", 0)
total = stats.get("total_titles_watched", 0)
shows = stats.get("unique_shows", 0)
top_show = stats.get("number_one_show", "Unknown")
top_count = stats.get("number_one_count", 0)
personality = stats.get("personality", {})
active_days = stats.get("active_days", 0)
top_shows = stats.get("top_shows", [])
streak = stats.get("longest_streak", 0)
binges = stats.get("binge_sessions", 0)
fav_day = stats.get("favorite_day", "Unknown")
biggest_binge = stats.get("biggest_binge", 0)
biggest_binge_show = stats.get("biggest_binge_show", "Unknown")
```

```{python}
display(HTML(f'''
<div class="hero">
    <h1>NETFLIX WRAPPED</h1>
    <div class="subtitle">Your Year in Streaming</div>
    <div class="year">{year}</div>
</div>

<div class="wrapped-section">
    <div class="section-title">THE BIG PICTURE</div>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="number">{hours:,.0f}</div>
            <div class="label">Hours Streamed</div>
            <div class="detail">That is {days:.1f} days of pure entertainment</div>
        </div>
        <div class="stat-card">
            <div class="number">{total:,}</div>
            <div class="label">Titles Watched</div>
            <div class="detail">Episodes, movies, documentaries, and more</div>
        </div>
        <div class="stat-card">
            <div class="number">{shows}</div>
            <div class="label">Unique Shows</div>
            <div class="detail">Your taste is impressively diverse</div>
        </div>
        <div class="stat-card">
            <div class="number">{active_days}</div>
            <div class="label">Active Days</div>
            <div class="detail">Days you pressed play this year</div>
        </div>
    </div>
</div>

<div class="wrapped-section">
    <div class="section-title">YOUR STREAMING PERSONALITY</div>
    <div class="personality-badge">
        <div class="type">{personality.get('type', 'The Viewer')}</div>
        <div class="description">{personality.get('description', 'You have unique viewing habits.')}</div>
    </div>
</div>

<div class="wrapped-section">
    <div class="section-title">YOUR NUMBER ONE</div>
    <div class="number-one-showcase">
        <div class="trophy-icon">1</div>
        <div class="show-title">{top_show}</div>
        <div class="show-stats">
            <span class="episode-count">{top_count}</span> episodes watched
        </div>
        <div class="show-bar-container">
            <div class="show-bar" style="width: 100%;"></div>
        </div>
    </div>
</div>
'''))
```

```{python}
# Top 5 Shows
if top_shows:
    max_count = top_shows[0]["count"] if top_shows else 1
    rows_html = ""
    for i, show in enumerate(top_shows[:5]):
        width = (show["count"] / max_count) * 100
        rank_class = "gold" if i == 0 else "silver" if i == 1 else "bronze" if i == 2 else ""
        rows_html += f'''
        <div class="show-row">
            <div class="show-rank {rank_class}">{i + 1}</div>
            <div class="show-info">
                <div class="show-name">{show["title"]}</div>
                <div class="show-bar-bg">
                    <div class="show-bar-fill" style="width: {width}%;"></div>
                </div>
            </div>
            <div class="show-count">{show["count"]}</div>
        </div>
        '''
    
    display(HTML(f'''
    <div class="wrapped-section">
        <div class="section-title" style="font-size: 2rem;">TOP 5 SHOWS</div>
        <div class="top-shows-chart">
            {rows_html}
        </div>
    </div>
    '''))
```

```{python}
# Monthly breakdown
monthly = stats.get("monthly_breakdown", {})
if monthly:
    max_val = max(monthly.values()) if monthly.values() else 1
    peak_month = max(monthly, key=monthly.get)
    
    months = ["January", "February", "March", "April", "May", "June", 
              "July", "August", "September", "October", "November", "December"]
    labels = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"]
    
    bars_html = ""
    for month, label in zip(months, labels):
        count = monthly.get(month, 0)
        height = (count / max_val) * 200 if max_val > 0 else 10
        peak_class = "peak" if month == peak_month else ""
        bars_html += f'''
        <div class="month-column">
            <div class="month-value">{count}</div>
            <div class="month-bar {peak_class}" style="height: {height}px;"></div>
            <div class="month-label">{label}</div>
        </div>
        '''
    
    display(HTML(f'''
    <div class="wrapped-section">
        <div class="section-title">YOUR YEAR AT A GLANCE</div>
        <div class="monthly-chart-container">
            <div class="month-bars">
                {bars_html}
            </div>
            <div class="peak-indicator">Peak: <span class="highlight">{peak_month}</span> with <span class="highlight">{monthly[peak_month]}</span> titles</div>
        </div>
    </div>
    '''))
```

```{python}
# When you watch
dow = stats.get("day_of_week", {})
time_cats = stats.get("time_categories", {})

if dow:
    max_dow = max(dow.values())
    fav_day_calc = max(dow, key=dow.get)
    
    days_order = ["Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun"]
    days_full = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
    
    day_rows = ""
    for short, full in zip(days_order, days_full):
        count = dow.get(full, 0)
        width = (count / max_dow) * 100 if max_dow > 0 else 0
        fav_class = "favorite" if full == fav_day_calc else ""
        day_rows += f'''
        <div class="day-row {fav_class}">
            <span class="day-name">{short}</span>
            <div class="day-bar-bg">
                <div class="day-bar-fill" style="width: {width}%;"></div>
            </div>
            <span class="day-count">{count}</span>
        </div>
        '''
    
    time_blocks = ""
    if time_cats:
        total_time = sum(time_cats.values())
        fav_time = max(time_cats, key=time_cats.get)
        
        time_labels_map = {
            "Morning (6am-12pm)": "Morning",
            "Afternoon (12pm-6pm)": "Afternoon",
            "Evening (6pm-10pm)": "Evening",
            "Night Owl (10pm-6am)": "Night"
        }
        
        for time_slot, count in time_cats.items():
            pct = round((count / total_time) * 100) if total_time > 0 else 0
            label = time_labels_map.get(time_slot, time_slot)
            fav_class = "favorite" if time_slot == fav_time else ""
            time_blocks += f'''
            <div class="time-block {fav_class}">
                <div class="time-pct">{pct}%</div>
                <div class="time-label">{label}</div>
                <div class="time-count">{count} titles</div>
            </div>
            '''
    
    display(HTML(f'''
    <div class="wrapped-section">
        <div class="section-title">WHEN YOU WATCH</div>
        <div class="when-grid">
            <div class="day-chart">
                <h3 class="chart-subtitle">By Day</h3>
                {day_rows}
                <div class="chart-note">Favorite day: <span class="highlight">{fav_day_calc}</span></div>
            </div>
            <div class="time-chart">
                <h3 class="chart-subtitle">By Time</h3>
                {time_blocks}
            </div>
        </div>
    </div>
    '''))
```

```{python}
# Fun facts
facts = stats.get("fun_facts", [])
facts_html = ""

for fact in facts:
    highlighted = highlight_numbers(fact)
    facts_html += f'<div class="fun-fact">{highlighted}</div>'

facts_html += f'<div class="fun-fact">Your favorite day to watch was <span class="highlight">{fav_day}</span>.</div>'
facts_html += f'<div class="fun-fact">You went on a <span class="highlight">{streak}</span>-day watching streak. Commitment level: expert.</div>'

if binges > 0:
    facts_html += f'<div class="fun-fact">You had <span class="highlight">{binges}</span> official binge sessions this year.</div>'

if biggest_binge > 0:
    facts_html += f'<div class="fun-fact">Your biggest binge was <span class="highlight">{biggest_binge}</span> episodes of <span class="highlight">{biggest_binge_show}</span> in one day.</div>'

display(HTML(f'''
<div class="wrapped-section">
    <div class="section-title">DID YOU KNOW?</div>
    {facts_html}
</div>
'''))
```

```{python}
# Year summary
avg_per_day = round(total / 365, 1)
avg_per_week = round(total / 52, 1)

display(HTML(f'''
<div class="wrapped-section">
    <div class="section-title">YOUR YEAR VISUALIZED</div>
    <div class="year-summary-grid">
        <div class="summary-card">
            <div class="summary-icon">AVG</div>
            <div class="summary-number">{avg_per_day}</div>
            <div class="summary-label">Titles per Day</div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">WK</div>
            <div class="summary-number">{avg_per_week}</div>
            <div class="summary-label">Titles per Week</div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">TOP</div>
            <div class="summary-number">{stats.get("peak_month_count", 0)}</div>
            <div class="summary-label">Best Month</div>
        </div>
        <div class="summary-card">
            <div class="summary-icon">RUN</div>
            <div class="summary-number">{streak}</div>
            <div class="summary-label">Day Streak</div>
        </div>
    </div>
</div>

<div class="wrapped-footer">
    <div class="tagline">Thanks for Streaming</div>
    <p>Same time next year?</p>
</div>
'''))
```
